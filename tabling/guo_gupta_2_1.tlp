:- tabled r/2 .

r( X, Y ) :-  r( X, Z ),  r( Z, Y ).
r( X, Y ) :-  p( X, Y ),  q( Y ).

p( a, b ).
p( a, d ).
p( b, c ).

q( b ).
q( c ).

?- r( a, Y ).

?- r( b, Y ).

?- r( c, Y ).
